version: "3.8"

services:
  studio:
    # Use the image from your container registry
    image: ${DOCKER_REGISTRY:-ghcr.io}/${DOCKER_IMAGE_NAME:-training-tool}/studio:${IMAGE_TAG:-latest}
    container_name: training-tool-studio
    ports:
      - "${STUDIO_PORT:-3333}:3333"
    # Note: Sanity Studio configuration (project ID, dataset) is baked into the build
    # Environment variables are not needed at runtime when serving static files with nginx
    restart: unless-stopped
    healthcheck:
      test:
        [
          "CMD",
          "wget",
          "--quiet",
          "--tries=1",
          "--spider",
          "http://localhost:3333/studio",
        ]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 5s
    # Resource limits for production
    deploy:
      resources:
        limits:
          cpus: "1.0"
          memory: 512M
        reservations:
          cpus: "0.5"
          memory: 256M
    # Security: run as non-root user
    user: "1000:1000"
    # Read-only root filesystem (if your app supports it)
    # read_only: true
    # tmpfs for writable directories if needed
    # tmpfs:
    #   - /tmp
